<!DOCTYPE html>
<html>

<head>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport"
	content="width=device-width, height=device-height, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">

<title>BBDP</title>

<!-- Shortcut Icon -->
<link rel="Shortcut Icon" type="image/x-icon"
	href="picture/doctor-frame/icon.ico">

<!-- Bootstrap Core CSS -->
<link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

<!-- MetisMenu CSS -->
<link href="vendor/metisMenu/metisMenu.min.css" rel="stylesheet">

<!-- Custom CSS -->
<link href="dist/css/sb-admin-2.css" rel="stylesheet">

<!-- Custom Fonts -->
<link href="vendor/font-awesome/css/font-awesome.min.css"
	rel="stylesheet" type="text/css">
<script src="js/modalGenerator.js"></script>
<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

<!-- jQuery -->
<!-- <script src="vendor/jquery/jquery.min.js"></script> -->
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<!-- 有關下拉式選單 -->
<script src="vendor/bootstrap/js/bootstrap.min.js"></script>

<!-- Metis Menu Plugin JavaScript -->
<!-- 有關下拉式選單 -->
<script src="vendor/metisMenu/metisMenu.min.js"></script>
<!-- Custom Theme JavaScript -->
<!-- 有關下拉式選單 -->
<script src="dist/js/sb-admin-2.js"></script>
<!-- 醫生端框架css -->
<link href="css/doctorFrame.css" rel="stylesheet" type="text/css">
	<style type="text/css">
		.lattice {
				border: 3px solid #f0f0f0;
			}
	</style>
</head>
	<script>
		//一進來就先判斷是否已經登入，沒有的話自動跳轉至登入頁面
		$(document).ready(function() {
			if(!(window.localStorage.getItem('login'))){
			window.location.href = 'Login.html';
			}
		})
</script>
<script>

	var user = window.localStorage.getItem('login');

	function delTempStorage(){
	
		var questionArray = "";
		$('input:checkbox:checked[name="Qcheckbox"]').each(function(i) { questionArray += (this.value+",");});
		if(questionArray=="")
			window.modalGenerator("提示", "請勾選欲移除題目");
		else{
			$.ajax({
				url : "http://140.121.197.130:8000/BBDPDoctor/QuestionnaireTempStorageServlet",
				data : {
					state : "deleteTempStorage",
					doctorID : user,
					questionArray : questionArray
				},
				traditional: true,
				success : function(response) {
					location.reload();
				},
				error : function() {
					console.log("錯誤訊息");
				}
			});
		}
	}

	function goToEdit(number){
		var QBtnID = $('#QPbtn'+number).val();
		$.ajax({
			url : "http://140.121.197.130:8000/BBDPDoctor/QuestionnairePoolServlet",
			data : {
				state : "selectQPID",		//配合修改去取值
				selectName : QBtnID,
				doctorID : user
			},

			success : function(response) {
				window.location.href = 'EditQuestionnairePool.html?Qid='+response;
			},
			error : function() {
				console.log("錯誤訊息");
			}
		});			
	}
	
	function clickQustion(number){	
		var QBtnName = $('#QPbtn'+number).val();
		
		var temp="";
		
		$.ajax({
			url : "http://140.121.197.130:8000/BBDPDoctor/QuestionnaireTempStorageServlet",
			data : {
				state : "viewQuestion",
				selectName : QBtnName,
				doctorID : user
			},
			dataType : "json",
			success : function(response) {
				temp = '<div><input type="button" class="btn btn-default" value="修改" style="background-color:#f0f0f0;font-size:13px;float:right;" onclick="goToEdit('+number+')"></div>	<div style="height:52px;"></div>';
				temp+="<div class='panel' style='border-color:#D2F898;width:100%;'><div class='panel-heading' style='background-color:#D2F898;'>"+QBtnName+"</div>";
				temp+="<div class='panel-body'>";
				for(var i =0;i<response.length;i++){
					temp+=response[i].score+"="+response[i].content+"<br>";
				}
				temp+="</div></div>";
			},
			error : function() {
				temp = '<div><input type="button" class="btn btn-default" value="修改" style="background-color:#f0f0f0;font-size:13px;float:right;" onclick="goToEdit('+number+')"></div>	<div style="height:52px;"></div>';
				temp+="<div class='panel' style='border-color:#D2F898;width:100%;'><div class='panel-heading' style='background-color:#D2F898;'>"+QBtnName+"</div></div>";
				
			}
		});
		
	    $(document).ajaxComplete(function(){
			$("#QPview").empty();
	    	$("#QPview").append(temp);
	    });	
	}
	

	
	$(document).ready(function() {
		$.ajax({
			url : "http://140.121.197.130:8000/BBDPDoctor/QuestionnaireTempStorageServlet",
			data : {
				state : "searchQPType",
				doctorID : user
			},
			dataType : "json",
		
			success : function(response) {
				$("#QPType").empty();
				var temp="<option value=''>題目分類</option>";
				for(var i=0;i<response.length;i++){
					temp+="<option value='"+response[i]+"'>"+response[i]+"</option>";
				}	
				temp+="</select>";
				$("#QPType").append(temp);
			},
			error : function() {
				console.log("錯誤訊息");
			}
		});
		
		$.ajax({
			url : "http://140.121.197.130:8000/BBDPDoctor/QuestionnaireTempStorageServlet",
			data : {
				state : "selectQPType",
				selectType : $('#QPType option:selected').val(),
				doctorID : user
			},
			dataType : "json",
			success : function(response) {
				$("#QuestionList").empty();
				var temp="";
				var questionNumber=0;
				for(var i=0;i<response.length;i++){
					questionNumber++;
					temp+="<div><input type='checkbox' value='"+response[i]+"' name='Qcheckbox' style='zoom: 1.5;vertical-align:middle;overflow : hidden;'><input class='btn btn-default' value='"+response[i]+"' id='QPbtn"+questionNumber+"' type= 'button'style='text-align:left;width:85%;height:70px;background-color:#D2F898;vertical-align:middle;font-size:15px;border:none;text-overflow: ellipsis; overflow : hidden;'onclick='clickQustion("+questionNumber+")'></div><div style='height:7px'></div>";
				}	
				$("#QuestionList").append(temp);
			},
			error : function() {
				console.log("錯誤訊息");
			}
		});
		$('#QPType').change(function(){
			$.ajax({
				url : "http://140.121.197.130:8000/BBDPDoctor/QuestionnaireTempStorageServlet",
				data : {
					state : "selectQPType",
					selectType : $('#QPType option:selected').val(),
					doctorID : user
				},
				dataType : "json",
				success : function(response) {
					$("#QuestionList").empty();
					var temp="";
					var questionNumber=0;
					for(var i=0;i<response.length;i++){
						questionNumber++;
						temp+="<div><input type='checkbox' value='"+response[i]+"' name='Qcheckbox' style='zoom: 1.5;vertical-align:middle;'><input class='btn btn-default' value='"+response[i]+"' id='QPbtn"+questionNumber+"' type= 'button'style='text-align:left;width:85%;height:70px;background-color:#D2F898;vertical-align:middle;font-size:15px;border:none;text-overflow: ellipsis; overflow : hidden;'onclick='clickQustion("+questionNumber+")'></div><div style='height:7px'></div>";
					}	
					$("#QuestionList").append(temp);
				},
				error : function() {
					console.log("錯誤訊息");
				}
			});	
		});
		
		
		
	});
	

</script>
<body>

	<div id="wrapper">

		<!-- Navigation -->
		<nav class="navbar navbar-default navbar-static-top" role="navigation"
			style="margin-bottom: 0"></nav>

		<!-- page-wrapper -->
		<div id="page-wrapper">
			<div class="row">
				<div class = "col-sm-4">
					<br>
					<div class = "col-sm-12">
					<div>
					<button type="button" class="btn btn-default" style="background-color:#f0f0f0;font-size:13px;"onclick="delTempStorage()">將勾選題目刪除</button>
					</div>
					<br>
					    <div class="panel panel-default lattice left-list" style="border: 4px solid #f0f0f0;">
							<div class="panel-heading">							
								<form>						
									<select class="form-control" id="QPType" style="width:80%;">
										<option value="all">題目分類</option>
									</select>	
								</form>
							</div>
							<div class="panel-body" style="min-height: 70vh; max-height: 70vh; overflow-y: auto;" id="QuestionList"></div>
						</div>

					</div>
				</div>
			
				<div class = "col-sm-8">
					<br>
					<div id = 'QPview'>						
						
					</div>
				</div>					
			
			
			
			
			
			</div>
		</div>

	</div>

	<!-- 醫生端框架js -->
	<script src="js/doctorFrame.js"></script>

</body>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    

</html>